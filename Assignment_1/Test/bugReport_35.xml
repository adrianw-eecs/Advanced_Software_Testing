<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:40:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-35/HBASE-35.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-35] [hbase] Make BatchUpdate public in the API</title>
                <link>https://issues.apache.org/jira/browse/HBASE-35</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Today, when you want to interact with a row in HBase, you start an update, make changes, and then commit the lock. This is fine for very simple applications. However, when you try to do things like support table operations as part of a MapReduce job, it becomes more difficult to support.&lt;/p&gt;

&lt;p&gt;I propose that we create a new class, RowMutation (a la the Bigtable paper), which encapsulates a group of actions on a row, and make this available to API consumers. It might look something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RowMutation r = table.getMutation(row_key);
r.setTimestamp(1111);
r.put(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(&lt;span class=&quot;code-quote&quot;&gt;&quot;colfam1:name&quot;&lt;/span&gt;, value));
r.delete(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(&lt;span class=&quot;code-quote&quot;&gt;&quot;colfam2:deleted&quot;&lt;/span&gt;));
table.commit(r);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This syntax would supercede the existing startUpdate/commit format, which could be deprecated and mapped to a RowMutation behind the scenes. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12386285">HBASE-35</key>
            <summary>[hbase] Make BatchUpdate public in the API</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanduxbury">Bryan Duxbury</assignee>
                                    <reporter username="bryanduxbury">Bryan Duxbury</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jan 2008 17:38:29 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:04 +0000</updated>
                            <resolved>Thu, 7 Feb 2008 19:51:43 +0000</resolved>
                                                    <fixVersion>0.2.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12559143" author="bryanduxbury" created="Tue, 15 Jan 2008 17:43:33 +0000"  >&lt;p&gt;Also note, this change would allow multiple &quot;concurrent&quot; updates to go on against the same HTable instance at once, as the changes would be tracked in the RowMutation instance, rather than internal to the HTable.&lt;/p&gt;</comment>
                            <comment id="12559166" author="stack" created="Tue, 15 Jan 2008 18:49:41 +0000"  >&lt;p&gt;+1  Its the &quot;Maybe we should pass a superclass of BatchUpdate here...&quot; postulated as soln. over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-53&quot; title=&quot;TableOutputFormat could not assign a timestamp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-53&quot;&gt;&lt;del&gt;HADOOP-2508&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12563272" author="bryanduxbury" created="Mon, 28 Jan 2008 20:15:30 +0000"  >&lt;p&gt;Here&apos;s a first stab at it.&lt;/p&gt;</comment>
                            <comment id="12563279" author="stack" created="Mon, 28 Jan 2008 20:37:18 +0000"  >&lt;p&gt;You should have your constructors cascade rather than dupe setup code: i.e. RowMutation(Text) should call RowMutation(Text, long) (You write super(row, HConstants.LATEST_TIMESTAMP).&lt;/p&gt;

&lt;p&gt;You could also make the data members final &amp;#8211; i.e. RowMutation timestamp and row are passed on construction and thereafter cannot be changed.&lt;/p&gt;

&lt;p&gt;IMO, declaration and assignment all on the one line is easier on the reader as in:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;Text, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt; mutations = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;Text, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Timestamp should be LATEST_TIMESTAMP rather than -1L.&lt;/p&gt;

&lt;p&gt;Is convertToBatchUpdate temporary? Do you intend on making it so servers take RowMutations, or, easier, why not let out BatchUpdate?  Is RowMutation different in any way other than in name?&lt;/p&gt;</comment>
                            <comment id="12563281" author="bryanduxbury" created="Mon, 28 Jan 2008 21:00:40 +0000"  >&lt;p&gt;I will incorporate suggestions into a new patch.&lt;/p&gt;

&lt;p&gt;The rationale behind using a new class for the public API was that we didn&apos;t necessarily want to expose the BatchUpdate because it&apos;s part of our server protocol. I wouldn&apos;t be against making server take RowMutations or exposing BatchUpdate if that makes more sense in the long run. I was also trying to remove the worthless update code and such needing to be created.&lt;/p&gt;</comment>
                            <comment id="12563293" author="stack" created="Mon, 28 Jan 2008 21:27:41 +0000"  >&lt;p&gt;Regards needing this for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-53&quot; title=&quot;TableOutputFormat could not assign a timestamp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-53&quot;&gt;&lt;del&gt;HADOOP-2508&lt;/del&gt;&lt;/a&gt; &amp;#8211; having TableOutputFormat take a RowMutation/BatchUpdate &amp;#8211; its not necessary.&lt;/p&gt;</comment>
                            <comment id="12563295" author="jimk" created="Mon, 28 Jan 2008 21:34:24 +0000"  >&lt;p&gt;I don&apos;t see a significant difference between RowMutation and BatchUpdate other than RowMutation takes a timestamp.&lt;/p&gt;

&lt;p&gt;Why not let BatchUpdate be a public class, and add two new commit methods:&lt;/p&gt;

&lt;p&gt;commit(BatchUpdate b)&lt;br/&gt;
commit(BatchUpdate b, long timestamp)&lt;/p&gt;

&lt;p&gt;then move the body of commit that deals with sending the batch to the region server to commitInternal(BatchUpdate, long)&lt;/p&gt;

&lt;p&gt;With respect to lockid being useless in the current API, and that currently we only support one update at a time, consider changing HTable.batch to be a concurrent list, then the &apos;lockid&apos; becomes the index into the list.&lt;/p&gt;
</comment>
                            <comment id="12563304" author="bryanduxbury" created="Mon, 28 Jan 2008 21:55:47 +0000"  >&lt;p&gt;Part of the objective of this issue was to move the timestamp parameter into the RowMutation so that it could be emitted as part of MapReduce job. I have no problem using BatchUpdate, so long as it carries a timestamp with it. Or is that no longer a worthwhile objective?&lt;/p&gt;</comment>
                            <comment id="12563310" author="stack" created="Mon, 28 Jan 2008 22:07:05 +0000"  >&lt;p&gt;For sure, this area of API needs cleanup but regards BatchUpdate being passed to TableOutputFormat, I think there&apos;s now a better soln.  See 2508.  It&apos;ll be cleaner than passing a BatchUpdate.  Passing BatchUpdate, the row will be present twice both as the passed in key and as a field of BatchUpdate.  Other advantage of new idea is that rows for same timestamp sort together.&lt;/p&gt;</comment>
                            <comment id="12564261" author="bryanduxbury" created="Thu, 31 Jan 2008 01:41:36 +0000"  >&lt;p&gt;After talking with Jim and Stack, we&apos;re going to:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make BatchUpdate a public class&lt;/li&gt;
	&lt;li&gt;Add timestamp to BatchUpdate&lt;/li&gt;
	&lt;li&gt;Add a commit() that takes a BatchUpdate&lt;/li&gt;
	&lt;li&gt;Deprecate commit() methods that take a timestamp parameter&lt;/li&gt;
	&lt;li&gt;Modify the communication between HTable and HRegionServer to use timestamp from BatchUpdate and remove timestamp parameter from batchUpdate&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the case of MapReduce jobs, you should build a BatchUpdate object with the row, timestamp, and puts/deletes you want, then emit it as the key with a small or empty value. BatchUpdate will implement WritableComparable so that BatchUpdates with the same row/timestamp can be merged and applied together.&lt;/p&gt;</comment>
                            <comment id="12565135" author="bryanduxbury" created="Sun, 3 Feb 2008 02:25:41 +0000"  >&lt;p&gt;Here&apos;s a patch of the latest discussed approach. Should probably update all the tests to use BatchUpdate instead of old approach before this patch is ultimately committed.&lt;/p&gt;</comment>
                            <comment id="12565143" author="bryanduxbury" created="Sun, 3 Feb 2008 05:02:50 +0000"  >&lt;p&gt;Here&apos;s a better patch. BatchUpdate objects are used internally in favor of the deprecated startUpdate method.&lt;/p&gt;</comment>
                            <comment id="12565144" author="bryanduxbury" created="Sun, 3 Feb 2008 05:03:09 +0000"  >&lt;p&gt;Tests pass locally.&lt;/p&gt;</comment>
                            <comment id="12565149" author="hadoopqa" created="Sun, 3 Feb 2008 06:36:15 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12374626/2611-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12374626/2611-v3.patch&lt;/a&gt;&lt;br/&gt;
against trunk revision 616796.&lt;/p&gt;

&lt;p&gt;    @author +1.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    javadoc -1.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;    javac +1.  The applied patch does not generate any new javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    release audit +1.  The applied patch does not generate any new release audit warnings.&lt;/p&gt;

&lt;p&gt;    findbugs +1.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    core tests +1.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    contrib tests -1.  The patch failed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1731/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1731/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1731/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1731/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1731/artifact/trunk/build/test/checkstyle-errors.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1731/artifact/trunk/build/test/checkstyle-errors.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1731/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1731/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12565185" author="bryanduxbury" created="Sun, 3 Feb 2008 16:07:08 +0000"  >&lt;p&gt;Failure was in TestTableMapReduce, our old favorite. Trying Hudson again.&lt;/p&gt;</comment>
                            <comment id="12565196" author="hadoopqa" created="Sun, 3 Feb 2008 17:58:31 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12374626/2611-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12374626/2611-v3.patch&lt;/a&gt;&lt;br/&gt;
against trunk revision 616796.&lt;/p&gt;

&lt;p&gt;    @author +1.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    javadoc -1.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;    javac +1.  The applied patch does not generate any new javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    release audit +1.  The applied patch does not generate any new release audit warnings.&lt;/p&gt;

&lt;p&gt;    findbugs +1.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    core tests -1.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    contrib tests +1.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1734/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1734/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1734/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1734/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1734/artifact/trunk/build/test/checkstyle-errors.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1734/artifact/trunk/build/test/checkstyle-errors.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1734/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1734/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12565477" author="bryanduxbury" created="Mon, 4 Feb 2008 19:09:37 +0000"  >&lt;p&gt;Update for new svn.&lt;/p&gt;</comment>
                            <comment id="12565627" author="bryanduxbury" created="Tue, 5 Feb 2008 02:33:55 +0000"  >&lt;p&gt;Made a mistake editing patch for new svn.&lt;/p&gt;</comment>
                            <comment id="12566471" author="bryanduxbury" created="Thu, 7 Feb 2008 06:53:50 +0000"  >&lt;p&gt;Cleaned up to apply post-415&lt;/p&gt;</comment>
                            <comment id="12566487" author="jimk" created="Thu, 7 Feb 2008 08:17:53 +0000"  >&lt;p&gt;I ran the test suite and it succeeded, except that TestRegionServerExit failed, for the same reason that I talked about in email.&lt;/p&gt;

&lt;p&gt;Consequently, I&apos;m giving this patch a +1 and opening a new Jira for TestRegionServerExit&lt;/p&gt;</comment>
                            <comment id="12566673" author="bryanduxbury" created="Thu, 7 Feb 2008 16:32:55 +0000"  >&lt;p&gt;I had the same error in TestRegionServerExit. Otherwise patch passes tests. Let&apos;s commit.&lt;/p&gt;</comment>
                            <comment id="12566760" author="stack" created="Thu, 7 Feb 2008 19:51:43 +0000"  >&lt;p&gt;Committed.  Thanks for the patch Bryan.&lt;/p&gt;

&lt;p&gt;Patch is great.  Makes client easier to understand.&lt;/p&gt;

&lt;p&gt;Few things:&lt;/p&gt;

&lt;p&gt;+ You should just remove dross like this rather than comment it out:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+/*        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lockid = t.startUpdate(newRegions[i].getRegionName());
         t.put(lockid, COL_REGIONINFO, Writables.getBytes(
           newRegions[i].getRegionInfo()));
-        t.commit(lockid);
+        t.commit(lockid);*/
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;+ Someone put ^M&apos;s into HTable (Not you &amp;#8211; I&apos;d suspect that PC user JK)&lt;/p&gt;</comment>
                            <comment id="12566766" author="bryanduxbury" created="Thu, 7 Feb 2008 20:05:58 +0000"  >&lt;p&gt;Those comments definitely shouldn&apos;t have been there. They should have been removed after everything was working.&lt;/p&gt;</comment>
                            <comment id="12566770" author="jimk" created="Thu, 7 Feb 2008 20:11:48 +0000"  >&lt;p&gt;Note for future: please run &apos;ant package&apos; instead of just &apos;ant&apos; to build. This will detect any javadoc errors that may have been introduced.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12383925">HBASE-385</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12383925">HBASE-385</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12385424">HBASE-53</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12374731" name="35-v2.patch" size="30509" author="bryanduxbury" created="Tue, 5 Feb 2008 02:33:55 +0000"/>
                            <attachment id="12374948" name="35-v3.patch" size="30509" author="bryanduxbury" created="Thu, 7 Feb 2008 06:53:50 +0000"/>
                            <attachment id="12374698" name="35.patch" size="30548" author="bryanduxbury" created="Mon, 4 Feb 2008 19:09:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Jan 2008 18:49:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31637</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h3on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>