<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:40:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-27/HBASE-27.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-27] [hbase] hregioninfo cell empty in meta table</title>
                <link>https://issues.apache.org/jira/browse/HBASE-27</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When we notice one of these, instead of reporting on it over and over &amp;#8211; see below &amp;#8211; lets just axe the whole row.   Its never going to get better on its own.  We should also figure how these horked rows get manufactured.  Below is about split cells but also instances where servercode and servername are all thats left in a row.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2008-01-24 02:01:02,761 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,761 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,762 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,762 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,762 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,763 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitB]
2008-01-24 02:01:02,763 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,763 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,764 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,764 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,764 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitB]
2008-01-24 02:01:02,765 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,765 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,765 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,766 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,766 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,766 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitB]
2008-01-24 02:01:02,767 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,767 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitB]
2008-01-24 02:01:02,767 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,768 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitB]
2008-01-24 02:01:02,768 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitB]
2008-01-24 02:01:02,768 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,769 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,769 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,769 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,770 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,770 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]
2008-01-24 02:01:02,771 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,771 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitB]
2008-01-24 02:01:02,771 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA, info:splitB]
2008-01-24 02:01:02,772 WARN org.apache.hadoop.hbase.HMaster:
info:regioninfo is empty; has keys: [info:splitA]


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12387000">HBASE-27</key>
            <summary>[hbase] hregioninfo cell empty in meta table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Jan 2008 05:23:27 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:04 +0000</updated>
                            <resolved>Thu, 13 Mar 2008 01:27:32 +0000</resolved>
                                    <version>0.1.0</version>
                                    <fixVersion>0.1.0</fixVersion>
                    <fixVersion>0.2.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12562109" author="jimk" created="Thu, 24 Jan 2008 15:55:23 +0000"  >&lt;p&gt;It appears that we are not cleaning out all the possible cells when a region is deleted.&lt;/p&gt;</comment>
                            <comment id="12562146" author="bryanduxbury" created="Thu, 24 Jan 2008 17:48:01 +0000"  >&lt;p&gt;Easy enough to switch to deleteAll(row). &lt;/p&gt;</comment>
                            <comment id="12564993" author="bryanduxbury" created="Sat, 2 Feb 2008 00:35:14 +0000"  >&lt;p&gt;Let&apos;s get this done in 0.17.&lt;/p&gt;</comment>
                            <comment id="12575986" author="bryanduxbury" created="Fri, 7 Mar 2008 00:38:50 +0000"  >&lt;p&gt;Not that important. Does this even happen anymore in trunk?&lt;/p&gt;</comment>
                            <comment id="12577203" author="jimk" created="Mon, 10 Mar 2008 21:28:42 +0000"  >&lt;p&gt;Patch for 0.1.0&lt;/p&gt;</comment>
                            <comment id="12577214" author="stack" created="Mon, 10 Mar 2008 21:45:00 +0000"  >&lt;p&gt;Why is the internal class RowMap made public?&lt;/p&gt;

&lt;p&gt;This patch is a band-aid on a real issue we have yet to find &amp;#8211; improper clean up of rows.  Maybe it can help us figure where the real prob. is by outputting more info about the row its deleting?  E.g., in deleteEmptyMetaRows, do you think it should enumerate all the cells that are remaining?  Might give us clue as to where the meta row removes is working improperly.&lt;/p&gt;

&lt;p&gt;Otherwise, patch looks good to me.&lt;/p&gt;
</comment>
                            <comment id="12577218" author="bryanduxbury" created="Mon, 10 Mar 2008 21:53:11 +0000"  >&lt;p&gt;Is there any chance that we are seeing the row halfway through an update? If so, then deleting the entire thing when one of the cells is empty would really break things. &lt;/p&gt;

&lt;p&gt;The original suggestion was to use deleteAll in situations where we wanted to delete a row, and assume that the problem was some rows were incompletely cleaned up because we weren&apos;t doing deleteAll before. In that regard, I think the change to HRegion is correct, but perhaps the cleanup in HMaster is premature. &lt;/p&gt;

&lt;p&gt;Should we commit a patch with just the HRegion deleteAll change, and see if this problem manifests itself any further?&lt;/p&gt;</comment>
                            <comment id="12577240" author="jimk" created="Mon, 10 Mar 2008 22:51:05 +0000"  >&lt;p&gt;stack - 10/Mar/08 02:45 PM &lt;br/&gt;
&amp;gt; Why is the internal class RowMap made public?&lt;/p&gt;

&lt;p&gt;The class is private static meaning that it is only visible to HMaster.&lt;/p&gt;

&lt;p&gt;The problem with the methods being private is that they had to be accessed through synthetic accessors. Could use package private I suppose, but if the class itself is not visible outside of HMaster, is it really a problem? I&apos;ll change to package visibility if you think so.&lt;/p&gt;

&lt;p&gt;&amp;gt; This patch is a band-aid on a real issue we have yet to find - improper clean up of rows.&lt;br/&gt;
&amp;gt; Maybe it can help us figure where the real prob. is by outputting more info about the row its deleting?&lt;br/&gt;
&amp;gt; E.g., in deleteEmptyMetaRows, do you think it should enumerate all the cells that are remaining?&lt;br/&gt;
&amp;gt; Might give us clue as to where the meta row removes is working improperly.&lt;/p&gt;

&lt;p&gt;The patch is a band-aid intended to be as minimal as possible while still making 0.1 work well&lt;br/&gt;
enough to release.&lt;/p&gt;

&lt;p&gt;Since all the calls to deleteEmptyMetaRows are made after a scan of a meta region (because&lt;br/&gt;
you don&apos;t want to update while you&apos;re scanning), I could make the callers output more information&lt;br/&gt;
since they know the context better than the low level method.&lt;/p&gt;

&lt;p&gt;&amp;gt; Bryan Duxbury - 10/Mar/08 02:53 PM&lt;br/&gt;
&amp;gt; Is there any chance that we are seeing the row halfway through an update? If so, then deleting the entire&lt;br/&gt;
&amp;gt; thing when one of the cells is empty would really break things.&lt;/p&gt;

&lt;p&gt;HRegionInfo should never be null so long as any other cell exists. It is written when a region is created&lt;br/&gt;
either via create table or split, and should not be deleted until both splitA and splitB are empty after&lt;br/&gt;
a split.&lt;/p&gt;

&lt;p&gt;&amp;gt; The original suggestion was to use deleteAll in situations where we wanted to delete a row, and&lt;br/&gt;
&amp;gt; assume that the problem was some rows were incompletely cleaned up because we weren&apos;t doing&lt;br/&gt;
&amp;gt; deleteAll before. In that regard, I think the change to HRegion is correct, but perhaps the cleanup in&lt;br/&gt;
&amp;gt; HMaster is premature. Should we commit a patch with just the HRegion deleteAll change, and see&lt;br/&gt;
&amp;gt; if this problem manifests itself any further?&lt;/p&gt;

&lt;p&gt;I think it will continue to happen even with deleteAll and since it really breaks things to have these&lt;br/&gt;
kind of rows around, nuking them can&apos;t really make matters worse.&lt;/p&gt;

&lt;p&gt;Adding the context around a delete should give us more insight into what we are doing when we&lt;br/&gt;
run over these land mines.&lt;/p&gt;

</comment>
                            <comment id="12577535" author="jimk" created="Tue, 11 Mar 2008 18:05:58 +0000"  >&lt;p&gt;Summary of changes:&lt;/p&gt;

&lt;p&gt;HMaster:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When a row has an empty HRegionInfo (info:regioninfo), log it with the row name and and the other keys still in the row.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Log the number of rows with empty HRegionInfo&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Delete the rows&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make RowMap inner class static, change methods to have package scope to avoid synthetic accessors.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Provide row name to getHRegionInfo so it can issue better log messages&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add method deleteEmptyMetaRows to remove rows with empty HRegionInfo&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HRegion&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;change removeRegionFromMETA to use deleteAll rather than using a BatchUpdate containing deletes for each cell.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;TestEmptyMetaInfo&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new test case&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Sample of new log messages:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit] 2008-03-11 11:00:34,078 INFO  [HMaster.metaScanner] hbase.HMaster$BaseScanner(211): HMaster.metaScanner scanning meta region {regionname: .META.,,1, startKey: &amp;lt;&amp;gt;, server: 10.69.80.2:3204}
    [junit] 2008-03-11 11:00:34,093 WARN  [HMaster.metaScanner] hbase.HMaster(3231): info:regioninfo is empty &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; row: tablename,1,1205258426000; has keys: [info:server]
    [junit] 2008-03-11 11:00:34,093 WARN  [HMaster.metaScanner] hbase.HMaster(3231): info:regioninfo is empty &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; row: tablename,1205258426000; has keys: [info:server]
    [junit] 2008-03-11 11:00:34,093 WARN  [HMaster.metaScanner] hbase.HMaster(3231): info:regioninfo is empty &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; row: tablename,2,1205258426000; has keys: [info:server]
    [junit] 2008-03-11 11:00:34,093 WARN  [HMaster.metaScanner] hbase.HMaster(3231): info:regioninfo is empty &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; row: tablename,3,1205258426000; has keys: [info:server]
    [junit] 2008-03-11 11:00:34,093 WARN  [HMaster.metaScanner] hbase.HMaster(3231): info:regioninfo is empty &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; row: tablename,4,1205258426000; has keys: [info:server]
    [junit] 2008-03-11 11:00:34,093 WARN  [HMaster.metaScanner] hbase.HMaster$BaseScanner(288): Found 5 rows with empty HRegionInfo &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; scanning meta region .META.,,1
    [junit] 2008-03-11 11:00:34,093 WARN  [HMaster.metaScanner] hbase.HMaster(3252): Removed region: tablename,1,1205258426000 from meta region: .META.,,1 because HRegionInfo was empty
    [junit] 2008-03-11 11:00:34,093 WARN  [HMaster.metaScanner] hbase.HMaster(3252): Removed region: tablename,1205258426000 from meta region: .META.,,1 because HRegionInfo was empty
    [junit] 2008-03-11 11:00:34,109 WARN  [HMaster.metaScanner] hbase.HMaster(3252): Removed region: tablename,2,1205258426000 from meta region: .META.,,1 because HRegionInfo was empty
    [junit] 2008-03-11 11:00:34,109 WARN  [HMaster.metaScanner] hbase.HMaster(3252): Removed region: tablename,3,1205258426000 from meta region: .META.,,1 because HRegionInfo was empty
    [junit] 2008-03-11 11:00:34,109 WARN  [HMaster.metaScanner] hbase.HMaster(3252): Removed region: tablename,4,1205258426000 from meta region: .META.,,1 because HRegionInfo was empty
    [junit] 2008-03-11 11:00:34,109 INFO  [HMaster.metaScanner] hbase.HMaster$BaseScanner(303): HMaster.metaScanner scan of meta region {regionname: .META.,,1, startKey: &amp;lt;&amp;gt;, server: 10.69.80.2:3204} complete
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12577701" author="stack" created="Wed, 12 Mar 2008 04:38:34 +0000"  >&lt;p&gt;Patch looks great as do the commit comments.  Suggest you include them when you apply the patch.  The patch applied to branch with some noise but no rejections.  All tests pass except TTMR but that ain&apos;t nothing new. +1&lt;/p&gt;</comment>
                            <comment id="12578113" author="jimk" created="Thu, 13 Mar 2008 01:27:32 +0000"  >&lt;p&gt;Committed to 0.1 and trunk. Resolving issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12377630" name="patch.txt" size="13023" author="jimk" created="Tue, 11 Mar 2008 18:05:58 +0000"/>
                            <attachment id="12377554" name="patch.txt" size="10644" author="jimk" created="Mon, 10 Mar 2008 21:28:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Jan 2008 15:55:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24865</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h3lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97844</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>