<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:40:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-20/HBASE-20.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-20] Regions getting messages from master to MSG_REGION_CLOSE_WITHOUT_REPORT</title>
                <link>https://issues.apache.org/jira/browse/HBASE-20</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I thank we addressed this here&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-194&quot; title=&quot;[hbase] Still multi-assigning regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-194&quot;&gt;&lt;del&gt;HADOOP-2295&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;but I have found it showing up again&lt;br/&gt;
my hlog size is set to 250,000&lt;/p&gt;

&lt;p&gt;so on a recovery from a failed region server the recovery of scanning the logs takes longer then the &lt;br/&gt;
hbase.hbasemaster.maxregionopen default of 30 secs&lt;/p&gt;

&lt;p&gt;and the master is thinks the region is open but the region server closes the region when done recovering becuase the master sent a &lt;br/&gt;
MSG_REGION_CLOSE_WITHOUT_REPORT to the region server.&lt;/p&gt;

&lt;p&gt;I was able to get my table back online completely by adding &lt;br/&gt;
hbase.hbasemaster.maxregionopen  with a value of 300000 mili secs to my hbase-site.xml file&lt;br/&gt;
and restart.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12386648">HBASE-20</key>
            <summary>Regions getting messages from master to MSG_REGION_CLOSE_WITHOUT_REPORT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="viper799">Billy Pearson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jan 2008 21:45:27 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:04 +0000</updated>
                            <resolved>Thu, 24 Apr 2008 04:18:02 +0000</resolved>
                                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12560562" author="viper799" created="Fri, 18 Jan 2008 21:46:43 +0000"  >&lt;p&gt;I was going to try and find the information in the logs but the logs are way big with all the debug info from the recovery&lt;/p&gt;</comment>
                            <comment id="12560641" author="viper799" created="Sat, 19 Jan 2008 02:17:27 +0000"  >&lt;p&gt;I thank that of two options that would help solve this problem and might need to use both &lt;/p&gt;

&lt;p&gt;option 1&lt;br/&gt;
build in a backlog limit on how many pending opens we can have in any one region server before stop accepting new opens.  &lt;br/&gt;
example finding the maximum sequence id for a region takes a lot less time then doing a recovery to a region. So its que would fill up faster making the master send some open request to different servers while this one catches up or loop until one of the region servers has open slots in it pending open que. I thank 60 secs is the default loop time so they should be able to hand 10 pending opens or something like that many be make it an option limit in the conf.&lt;/p&gt;

&lt;p&gt;option 2&lt;/p&gt;

&lt;p&gt;1.Confirm we received the masters open request once we received it&lt;/p&gt;

&lt;p&gt;Once confirmed master should not reassign the region to any other region server unless the region server goes off line and loses it lease&lt;/p&gt;

&lt;p&gt;2 Confirm the open of the region success or failed&lt;/p&gt;

&lt;p&gt;The master can make sure the region server is still alive by keeping up with heartbeat&lt;/p&gt;</comment>
                            <comment id="12561859" author="jimk" created="Wed, 23 Jan 2008 23:02:11 +0000"  >&lt;p&gt;&amp;gt; I thank that of two options that would help solve this problem and might need to use both&lt;/p&gt;

&lt;p&gt;&amp;gt; option 1&lt;br/&gt;
&amp;gt; build in a backlog limit on how many pending opens we can have in any one region server before stop &lt;br/&gt;
&amp;gt; accepting new opens.&lt;br/&gt;
&amp;gt; example finding the maximum sequence id for a region takes a lot less time then doing a recovery to a &lt;br/&gt;
&amp;gt; region. So its que would fill up faster making the master send some open request to different servers&lt;br/&gt;
&amp;gt; while this one catches up or loop until one of the region servers has open slots in it pending open que. I &lt;br/&gt;
&amp;gt; thank 60 secs is the default loop time so they should be able to hand 10 pending opens or something&lt;br/&gt;
&amp;gt; like that many be make it an option limit in the conf.&lt;/p&gt;

&lt;p&gt;&amp;gt; option 2&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; 1.Confirm we received the masters open request once we received it&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; Once confirmed master should not reassign the region to any other region server unless the region&lt;br/&gt;
&amp;gt; server goes off line and loses it lease&lt;/p&gt;

&lt;p&gt;In fact this exactly what happens today. When a region server receives an open region request, it replies&lt;br/&gt;
in its next heartbeat to the master with MSG_REPORT_PROCESS_OPEN which means, I got your request&lt;br/&gt;
and am working on it. When the master receives this message, it adds &lt;br/&gt;
hbase.hbasemaster.maxregionopen (currently 30 seconds) to the amount of time before it will try to&lt;br/&gt;
assign the region again. If it is taking longer than 30 seconds for a region server to open a region,&lt;br/&gt;
I would suggest increasing the value of this parameter to 60000 (60 seconds).&lt;/p&gt;

&lt;p&gt;&amp;gt; 2 Confirm the open of the region success or failed&lt;/p&gt;

&lt;p&gt;When the region server has opened the region, it sends a MSG_REPORT_OPEN to the master&lt;br/&gt;
meaning that it is now serving the region.&lt;/p&gt;

&lt;p&gt;&amp;gt; The master can make sure the region server is still alive by keeping up with heartbeat&lt;/p&gt;

&lt;p&gt;It is the region server that sends the heartbeat to the master, but this is exactly what happens.&lt;/p&gt;
</comment>
                            <comment id="12561879" author="viper799" created="Wed, 23 Jan 2008 23:56:38 +0000"  >&lt;p&gt;Currently I have to set hbase.hbasemaster.maxregionopen = 600000 (10 mins) when I have lots of regions about 150-175 over 4 nodes.&lt;/p&gt;

&lt;p&gt;I do not have a problem with the loading time until I have something happen and we have top rebuild from logs on a restart of the cluster.&lt;/p&gt;

&lt;p&gt;What happends is one server over loaded with more then the others with open request and it takes quite a long time to load the regions scanning the hlogs to rebuild the memcache.&lt;br/&gt;
Then we get open rerequest sent to other server to open the same regions and they start scanning the hlog to rebuild the memcache also.&lt;/p&gt;

&lt;p&gt;At some points I see many regions greater then what it should be open in the master gui, then they get the MSG_REGION_CLOSE_WITHOUT_REPORT from the master and close out some regionsbecuase they where re assigned again by the master. Some times they all do not open correctly and we have to restart again doing this all over again or sometimes more then one copy of a region stays open only one gets the updates but other still have the region loaded.&lt;/p&gt;

&lt;p&gt;lately if I do not know what the count of regions open should be I run a query with the shell to select a column that I know is in every region to scan the whole table and wait to see if I get a error or not to verfly that all regions are open. &lt;/p&gt;

&lt;p&gt;May be we should add the open que to limit the number of pending opens that a region can have pending at any point in time. I would suggest we have the region server send messages back to the master with the heartbeat messages with some of the regions it has open and loaded so that way we can find regions that do not get opened for some reasion but the master thanks it open. Maybe send 5 region per heartbeat that way we can make sure that every region is still alive on the region server. The current setup we could have some missed message to the master or region server and the master can be confused about what regions are open and what regions are not or we should have the clients report to the master when a region server returns a error when trying to read or write to a region that the region server saids its not servering but the master thank its is. Then the master can issue a close command to the region server and re assign the region. &lt;/p&gt;

&lt;p&gt;This is just some suggestions to consider as I have seen problems in this area where the master thanks one thing and the region server thank something else.&lt;/p&gt;</comment>
                            <comment id="12561892" author="stack" created="Thu, 24 Jan 2008 00:38:05 +0000"  >&lt;p&gt;I concur that hbase startup is kinda ugly when there are loads of regions.  I&apos;ve witnessed lots of thrashing with regions multiply assigned because startup is taking too long out on the regionservers.&lt;/p&gt;</comment>
                            <comment id="12561901" author="jimk" created="Thu, 24 Jan 2008 00:51:31 +0000"  >&lt;p&gt;+1 for idea of having region server reject new opens from master if it is too busy.&lt;/p&gt;</comment>
                            <comment id="12591852" author="stack" created="Wed, 23 Apr 2008 22:49:54 +0000"  >&lt;p&gt;I think this issue can be resolved for 0.2.0.  A bunch of stuff has been done to assuage thrashing on startup (having regionservers send heartbeat while region is being opened, balancing of regions across cluster).  Verify this is no longer an issue and then close.&lt;/p&gt;</comment>
                            <comment id="12591898" author="viper799" created="Thu, 24 Apr 2008 01:52:12 +0000"  >&lt;p&gt;I do not have a spare cluster of servers any more I had to put my them to work so if you fill this has been addressed then fill free to close.&lt;/p&gt;</comment>
                            <comment id="12591914" author="stack" created="Thu, 24 Apr 2008 04:18:02 +0000"  >&lt;p&gt;OK.  Thanks for chirping up Billy.  I&quot;ll close it as fixed (because of reasons given above).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Jan 2008 23:02:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24858</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h3i7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97830</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>