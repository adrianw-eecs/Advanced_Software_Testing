<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:40:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-72/HBASE-72.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-72] [hbase] &apos;Normal&apos; operation should not depend on throwing of exceptions (e.g. NotServingRegionException)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-72</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Region server and client logs will have lots of the following when a cluster is being loaded:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.hadoop.hbase.NotServingRegionException: hbaserepository,,7144829661993961256
        at org.apache.hadoop.hbase.HRegionServer.getRegion(HRegionServer.java:1208)
        at org.apache.hadoop.hbase.HRegionServer.getRegion(HRegionServer.java:1180)
        at org.apache.hadoop.hbase.HRegionServer.startUpdate(HRegionServer.java:1122)
        at org.apache.hadoop.hbase.HRegionServer.batchUpdate(HRegionServer.java:985)
        at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:340)
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:566)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The NotServingRegionException exception is thrown when the remote server is no longer serving the asked-for region (usually because its been split).  The server throws the exception to provoke the client into making a new interrogation of region locations.&lt;/p&gt;

&lt;p&gt;It would be an improvement if such &apos;normal&apos; operation was not built atop exceptions.  For example, commits might return a &apos;region moved&apos; message.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12376185">HBASE-72</key>
            <summary>[hbase] &apos;Normal&apos; operation should not depend on throwing of exceptions (e.g. NotServingRegionException)</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Aug 2007 17:43:57 +0000</created>
                <updated>Sun, 8 Jun 2014 21:42:14 +0000</updated>
                            <resolved>Sun, 8 Jun 2014 21:42:14 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12521511" author="jimk" created="Tue, 21 Aug 2007 16:12:52 +0000"  >&lt;p&gt;Looking at the (non-deprecated) methods in HRegionInterface, there are two that could return a status: batchUpdate and close (a scanner).&lt;/p&gt;

&lt;p&gt;However, the remainder return a value.&lt;/p&gt;

&lt;p&gt;The Java paradigm seems (to me at least) to be that methods return values or void and not a status code. Errors are handled by throwing exceptions. This is the paradigm that is followed by the other Hadoop RPC protocols.&lt;/p&gt;

&lt;p&gt;A client sending a request to the wrong server, either due to a bug or because the region has moved to another server feels like an error to me, and throwing an exception to get the client to &apos;recalibrate&apos; seems ok.&lt;/p&gt;

&lt;p&gt;The server really has no other choice because input parameters are final (any modification to them are not returned to the client).&lt;/p&gt;

&lt;p&gt;The only other thing we could do is wrap each returned value in another Writable which always contains a &quot;status message&quot;. This does not feel like the right paradigm to me.&lt;/p&gt;

&lt;p&gt;The only other solution I can think of is to make two RPCs for every one we make today. The first asks the server, &quot;Are you serving this region?&quot;, and based on that answer either sends the &quot;real&quot; message or &quot;recalibrates&quot;. Seems highly inefficient to me.&lt;/p&gt;

&lt;p&gt;If there are other ideas I have overlooked, please comment here.&lt;/p&gt;</comment>
                            <comment id="12521550" author="stack" created="Tue, 21 Aug 2007 18:57:24 +0000"  >&lt;p&gt;Here&apos;s a couple of comments.&lt;/p&gt;

&lt;p&gt;Those that return a value are all reads I believe.  Its unlikely a read will encounter a NotServingRegionException.  If they do, the circumstances are probably &apos;exceptional&apos; such as a crashed region server-- so an exception seems appropriate here.&lt;/p&gt;

&lt;p&gt;On the other hand, a stream of writes ineluctably provokes splits and region relocations.  IMO, such splits are not-unexpected and do not constitute an &apos;error&apos;, nor an  &apos;exceptional&apos; or &apos;abnormal&apos; condition.  Use of NSRE realigning the client strikes me as an instance of using exceptions to ordain program control.&lt;/p&gt;

&lt;p&gt;Seeing exceptions in the logs though all is working properly is unsettling.&lt;/p&gt;

&lt;p&gt;batchUpdate commit would seem to be the main provocateur of NotServingRegionExceptions during &apos;normal&apos; operation.  Currently it returns void.  Would it  be odd if just this one method returned a status code that had to be checked?  (Its rough counterpart in JDBC has a primitive status facility: &lt;a href=&quot;http://java.sun.com/j2se/1.5.0/docs/api/java/sql/Statement.html#executeBatch(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/j2se/1.5.0/docs/api/java/sql/Statement.html#executeBatch(&lt;/a&gt;)).&lt;/p&gt;










</comment>
                            <comment id="12521557" author="jimk" created="Tue, 21 Aug 2007 19:21:42 +0000"  >&lt;p&gt;Ok, I&apos;ll buy that argument. We&apos;ll change the API for commit only.&lt;/p&gt;</comment>
                            <comment id="12521597" author="jimk" created="Tue, 21 Aug 2007 21:23:44 +0000"  >&lt;p&gt;There are two cases for batchUpdate that I would consider to be &quot;normal operation&quot; as you have described it. Both could result from a region split: NotServingRegionException, and WrongRegionException (in which the row being updated falls outside the row range of the region that is being served).&lt;/p&gt;

&lt;p&gt;The other exceptions that might get thrown during a batch update really are problems: region is offline, region is closed, etc. These will remain exceptions.&lt;/p&gt;

&lt;p&gt;batchUpdate will be modified to return a boolean: true if successful; false if the server caught a NotServingRegionException or WrongRegionException. When the client receives a false answer, it needs to &quot;recalibrate&quot;&lt;/p&gt;</comment>
                            <comment id="12521643" author="jimk" created="Wed, 22 Aug 2007 00:26:45 +0000"  >&lt;p&gt;The only time a message is written to the logs is if DEBUG level logging is enabled. Under normal operation, the log level should be set to INFO in which case no stack trace will be visible unless the client runs out of retries (in which case both NotServingRegionException and WrongRegionException should be treated as errors).&lt;/p&gt;

&lt;p&gt;commit can not return a &quot;region moved&quot; message because the region server has no idea what happened some time earlier. It just knows that the region that was requested of it is not one of the ones it is serving.&lt;/p&gt;

&lt;p&gt;Debug logs are not pretty and if someone does enable them, then they are not operating &quot;normally&quot;.&lt;/p&gt;

&lt;p&gt;For these reasons I&apos;m inclined to not make this change.&lt;/p&gt;</comment>
                            <comment id="12521675" author="stack" created="Wed, 22 Aug 2007 04:17:53 +0000"  >&lt;p&gt;I didn&apos;t realize the exception only shows at DEBUG level.  That undoes the &quot;exceptions in the logs are unsettling&quot; but though its not showing, we are still using the exception mechanism to deal with normal operation.&lt;/p&gt;

&lt;p&gt;Regards &apos;region moved&apos; message, yes, region servers have no remembrance of regions past but I was thinking the commit return message nothing more than the boolean &amp;#8211; succeeded/failed &amp;#8211; that you suggested or a &apos;region ain&apos;t here&apos;. &lt;/p&gt;
</comment>
                            <comment id="12521681" author="jimk" created="Wed, 22 Aug 2007 04:52:32 +0000"  >&lt;p&gt;Since there are other implementations that subclass HRegionServer and HTable, We should not change the API without a better reason for doing so.&lt;/p&gt;</comment>
                            <comment id="12521859" author="jimk" created="Wed, 22 Aug 2007 17:19:57 +0000"  >&lt;p&gt;Re-opening issue.&lt;/p&gt;

&lt;p&gt;While it would be an improvement, there are a couple of reasons not to do it:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It changes the wire protocol and because we cannot overload the method (since the only change is in the return), we can&apos;t deprecate the current interface and replace it with a method of the same name. Instead we would have to create a new API with a different name.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;What we currently have works and perhaps the problem described above is a good reason not to do it.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12532796" author="hadoopqa" created="Fri, 5 Oct 2007 23:38:45 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org&lt;/a&gt;&lt;br/&gt;
against trunk revision r582413.&lt;/p&gt;

&lt;p&gt;    @author +1.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    patch -1.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/894/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/894/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12565522" author="bryanduxbury" created="Mon, 4 Feb 2008 20:56:25 +0000"  >&lt;p&gt;Can we close this issue? if there was a significant amount of desire to refactor this interaction, it&apos;d have been done by now. &lt;/p&gt;</comment>
                            <comment id="12589640" author="stack" created="Wed, 16 Apr 2008 16:45:50 +0000"  >&lt;p&gt;From the list, a new user is confused by this &apos;Exception&apos;; thinks it an error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Message-ID: &amp;lt;25e5a0c00804151554g5078a436pac74512979654294@mail.gmail.com&amp;gt;
Date: Tue, 15 Apr 2008 15:54:29 -0700
From: &lt;span class=&quot;code-quote&quot;&gt;&quot;Daniel Leffel&quot;&lt;/span&gt; &amp;lt;daniel.leffel@gmail.com&amp;gt;
To: hbase-user@hadoop.apache.org
Subject: Re: Region Server Processes Exit Unexpectedly during Moderate Load MapReduce
In-Reply-To: &amp;lt;25e5a0c00804151543o6e7ef438y6dfcb8babc6c582f@mail.gmail.com&amp;gt;
References: &amp;lt;25e5a0c00804150907p5f1c9796pf7ab288322ad70ab@mail.gmail.com&amp;gt;
	 &amp;lt;4804D3F6.4090002@duboce.net&amp;gt;
	 &amp;lt;25e5a0c00804151543o6e7ef438y6dfcb8babc6c582f@mail.gmail.com&amp;gt;

Now I just got &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; exception:

2008-04-15 18:50:02,107 DEBUG org.apache.hadoop.hbase.HStore: maximum
sequence id &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hstore 856584617/rule_id is 68555204
2008-04-15 18:50:02,284 INFO org.apache.hadoop.ipc.Server: IPC Server
handler 8 on 60020, call
batchUpdate(category_rule_pricebin_statistics,2332627_1_-11,1208293443363,
9223372036854775807, org.apache.hadoop.hbase.io.BatchUpdate@19d277e)
from 10.252.50.36:53955: error:
org.apache.hadoop.hbase.NotServingRegionException:
category_rule_pricebin_statistics,2332627_1_-11,1208293443363
org.apache.hadoop.hbase.NotServingRegionException:
category_rule_pricebin_statistics,2332627_1_-11,1208293443363
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12851960" author="ted_yu" created="Wed, 31 Mar 2010 17:06:36 +0000"  >&lt;p&gt;It is desirable to associate NotServingRegionException (the frequency, e.g.) with other recent errors in region server to alert the user of the real problem.&lt;/p&gt;</comment>
                            <comment id="14021396" author="apurtell" created="Sun, 8 Jun 2014 21:42:14 +0000"  >&lt;p&gt;Stale issue. Reopen if still relevant.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12377013">HBASE-359</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 21 Aug 2007 16:12:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31668</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h427:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97920</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>